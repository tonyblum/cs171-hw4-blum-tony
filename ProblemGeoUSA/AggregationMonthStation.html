<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script type="text/javascript" src="../jquery-1.11.0.min.js"></script>
<script src="../libs/FileSaver.js"></script>

<div id="vis"></div>


<script>


    d3.json("../data/allData2003_2004.json",function(error,data){
       // console.log(data);

        var allDates = [];
        var timeParser = d3.time.format("%b %-d, %Y %X %p");
		var structarr = new Array();

		for (var station in data){
			var totalsum = 0;
			var rdstruct = {total:0, hourly:{}};

			for (var i = 0; i< 24; i++){
				rdstruct.hourly[i] = 0;
			}
			// make an array of 

			var d = data[station];
			//console.log(d);
			d.forEach(function(dd){
				//console.log(key);
				//console.log(timeParser.parse(dd.date));
				var index = timeParser.parse(dd.date).getHours();
				if(index  === 0){
					rdstruct.hourly[0] += dd.value;
				}						
				if(index === 1){
					rdstruct.hourly[1] += dd.value;
				}
				if(index === 2){
					rdstruct.hourly[2] += dd.value;
				}
				if(index === 3){
					rdstruct.hourly[3] += dd.value;
				}
				if(index === 4){
					rdstruct.hourly[4] += dd.value;
				}
				if(index === 5){
					rdstruct.hourly[5] += dd.value;
				}
				if(index === 6){
					rdstruct.hourly[6] += dd.value;
				}
				if(index === 7){
					rdstruct.hourly[7] += dd.value;
				}
				if(index === 8){
					rdstruct.hourly[8] += dd.value;
				}
				if(index === 9){
					rdstruct.hourly[9] += dd.value;
				}
				if(index === 10){
					rdstruct.hourly[10] += dd.value;
				}
				if(index === 11){
					rdstruct.hourly[11] += dd.value;
				}
				if(index === 12){
					rdstruct.hourly[12] += dd.value;
				}				
				if(index === 13){
					rdstruct.hourly[13] += dd.value;
				}
				if(index === 14){
					rdstruct.hourly[14] += dd.value;
				}
				if(index === 15){
					rdstruct.hourly[15] += dd.value;
				}
				if(index === 16){
					rdstruct.hourly[16] += dd.value;
				}
				if(index === 17){
					rdstruct.hourly[17] += dd.value;
				}
				if(index === 18){
					rdstruct.hourly[18] += dd.value;
				}
				if(index === 19){
					rdstruct.hourly[19] += dd.value;
				}
				if(index === 20){
					rdstruct.hourly[20] += dd.value;
				}
				if(index === 21){
					rdstruct.hourly[21] += dd.value;
				}
				if(index === 22){
					rdstruct.hourly[22] += dd.value;
				}
				if(index === 23){
					rdstruct.hourly[23] += dd.value;
				}
				//hourlysum += 
				// this is cacluating one total sum rather than one total sum for each station
				totalsum += dd.value;
				rdstruct.total = totalsum;
			})
			//rdstruct[station] = totalsum;	
			structarr.push(rdstruct);			
		}
		console.log(structarr);
		//console.log(rdstruct);
        saveToFile(structarr,"reducedMonthStationHour2003_2004.json") // reducedDataSet

    })


    var saveToFile = function(object, filename){
        var blob, blobText;
        blobText = [JSON.stringify(object)];
        blob = new Blob(blobText, {
            type: "text/plain;charset=utf-8"
        });
        saveAs(blob, filename);
    }


</script>


</body>
</html>
